import{p as $}from"./video-fa94b0c9.js";import{i as P,j as U,p as j}from"./video-d189a443.js";import{f as O}from"./index-932def3d.js";import{_ as R,r as y,f as r,o as k,c as A,a as g,g as t,w as a,F as K,j as u,t as c,h as L,q as Q,n as G,v as H,E as w,p as J,k as W}from"./index-271749e0.js";import"./request-7a9563c7.js";const X=m=>(J("data-v-10271086"),m=m(),W(),m),Y=X(()=>g("br",null,null,-1)),Z={class:"dialog-footer"},ee={__name:"task",setup(m){const n=y({total:0,data:[],query:{limit:20,page:1,order:null,fileId:null,transcodeId:null},querySelect:{status:{"-1":"转码失败",0:"转码中",1:"转码成功"}}}),C=l=>{n.value.query.fileName=null,n.value.query.fileMd5=null,n.value.query.order=null,i()},q=l=>{n.value.query.page=l,i()},V=l=>{n.value.query.limit=l,i()},x=({column:l,prop:o,order:p})=>{let d="";p==="descending"?d="-":p==="ascending"&&(d="+"),n.value.query.order=d+o,i()},i=()=>{P(n.value.query).then(l=>{n.value.data=l.data,n.value.total=l.total})},I=l=>{H.confirm("请仔细确认是否删除 "+l.name+" ?","警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{U({id:l.id}).then(o=>{w.warning(o),i()})})},_=y(!1),h=y({}),S=l=>{h.value={autoplay:!0,controls:!0,sources:[l],html5:{vhs:{cacheEncryptionKeys:!0}}},_.value=!0},T=l=>{const o=document.createElement("textarea");o.value=l,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),w.info("复制成功")},B=l=>{l.status===0?j({id:l.id}).then(o=>{l.progress=Math.floor(o.progress)}):l.status===1&&S(l.OutFile)};return i(),(l,o)=>{const p=r("el-input"),d=r("el-form-item"),f=r("el-button"),F=r("el-form"),s=r("el-table-column"),v=r("el-link"),z=r("el-progress"),D=r("el-table"),E=r("el-pagination"),N=r("el-main"),M=r("el-dialog");return k(),A(K,null,[g("div",null,[t(F,{inline:!0},{default:a(()=>[t(d,{label:"源文件"},{default:a(()=>[t(p,{modelValue:n.value.query.fileId,"onUpdate:modelValue":o[0]||(o[0]=e=>n.value.query.fileId=e),placeholder:"源文件",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"编码器"},{default:a(()=>[t(p,{modelValue:n.value.query.transcodeId,"onUpdate:modelValue":o[1]||(o[1]=e=>n.value.query.transcodeId=e),placeholder:"编码器",clearable:""},null,8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(f,{type:"primary",icon:"search",onClick:i},{default:a(()=>[u(" 查询 ")]),_:1}),t(f,{type:"info",icon:"Refresh",onClick:C},{default:a(()=>[u(" 重置 ")]),_:1})]),_:1})]),_:1})]),t(N,{style:{"background-color":"#fff"}},{default:a(()=>[t(D,{data:n.value.data,onSortChange:x},{default:a(()=>[t(s,{fixed:"",prop:"id",label:"ID",width:"80",sortable:"custom",align:"center"}),t(s,{prop:"fileId",label:"文件","min-width":"180",align:"center"},{default:a(e=>[u(c(e.row.VideoFile.fileName),1)]),_:1}),t(s,{prop:"transcodeId",label:"编码器","min-width":"80",align:"center"},{default:a(e=>[u(c(e.row.VideoTranscode.name),1)]),_:1}),t(s,{prop:"status",label:"状态",width:"80",align:"center"},{default:a(e=>[t(v,{type:e.row.status>0?"success":"danger",onClick:b=>B(e.row)},{default:a(()=>[u(c(n.value.querySelect.status[e.row.status]),1)]),_:2},1032,["type","onClick"]),e.row.status==0&&e.row.progress?(k(),L(z,{key:0,type:"circle",percentage:e.row.progress,width:60},null,8,["percentage"])):Q("",!0)]),_:1}),t(s,{label:"执行参数","min-width":"180","header-align":"center"},{default:a(e=>[g("pre",null,c(e.row.options),1)]),_:1}),t(s,{label:"输出文件路径","min-width":"260",align:"center"},{default:a(e=>[t(v,{onClick:b=>T(e.row.outFile)},{default:a(()=>[u(c(e.row.outFile)+" ["+c(G(O)(e.row.outSize))+"] ",1)]),_:2},1032,["onClick"])]),_:1}),t(s,{prop:"createdAt",label:"创建日期","min-width":"170",align:"center"}),t(s,{fixed:"right",label:"操作",width:"120"},{default:a(e=>[t(f,{link:"",type:"danger",onClick:b=>I(e.row)},{default:a(()=>[u(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),Y,t(E,{background:"",layout:"total, sizes, prev, pager, next",total:n.value.total,"page-size":n.value.query.limit,onCurrentChange:q,onSizeChange:V},null,8,["total","page-size"])]),_:1}),t(M,{modelValue:_.value,"onUpdate:modelValue":o[3]||(o[3]=e=>_.value=e),title:"播放",width:"40%","destroy-on-close":"",center:""},{footer:a(()=>[g("span",Z,[t(f,{type:"primary",onClick:o[2]||(o[2]=e=>_.value=!1)},{default:a(()=>[u(" 关闭 ")]),_:1})])]),default:a(()=>[t($,{options:h.value},null,8,["options"])]),_:1},8,["modelValue"])],64)}}},re=R(ee,[["__scopeId","data-v-10271086"]]);export{re as default};
